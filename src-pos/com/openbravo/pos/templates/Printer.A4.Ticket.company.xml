<?xml version="1.0" encoding="UTF-8"?>

<output>

<display>
	<line><text align="left" length="10">Skupaj</text><text align="right" length="10">${ticket.printTotal()}</text></line>
	<line><text align="center" length="20">Hvala za nakup</text></line>
</display>

<ticket>
<!-- ********************************************************************************************************************************************************************************  -->
<!-- DEKLARACIJA KONSTANT -->
    <!-- DEKLARACIJA PODATKOV O PODJETJU -->
    #set( $ime = "Ime podjetja s.p." )
    #set( $naslov = "Ulica 39" )
    #set( $posta = "2999, Kraj pošte" )
    #set( $davcna = "837465588" )
    #set( $maticna = "Matična št.: 800403837465588" )
    #set( $trr = "TRR: SI56 6754 0987 4354 198" )
    #set( $telefon = "Tel.: 02 123 45 67" )
    #set( $faks = "Faks: 02 123 45 99" )
    #set( $email = "E-pošta: info@podjetje.si" )
    #set( $www = "Splet: www.micro-open.si" )
    <!-- KONEC - DEKLARACIJA PODATKOV O PODJETJU -->
    <!-- DEKLARACIJA UPOREBLJENIH IZRAZOV -->
    #set( $krajIzdaje = "Kraj izdaje: Kraj izdaje računa")
    #set( $labelTaxid = "Id za DDV: " )
    #set( $labelTicketdate = "Datum izdaje:" )
    #set( $labelServicedate = "Datum storitve:" )
    #set( $labelDeliverydate = "Datum dobave:" )
    #set( $labelCashdate = "Datum valute:" )
    #set( $labelReference = "Referenca:" )
    #set( $labelUsername = "Izdal:" )
    #set( $labelRefund = "Storno št.:")
    #set( $labelTicketnumber = "Račun št.:" )
    #set( $labelPreinvoice = "Informativni predračun" )
    #set( $nazivStranke = "Kupec:" )
<!-- KONEC - DEKLARACIJA KONSTANT -->
 <!-- DEKLARACIJA LASTNOSTI -->   
    #set( $stranka = $ticket.getCustomer() )
    #set( $lastnosti = $ticket.getProperties() )
    #set( $zavezanecDDV = "true")
<!-- KONEC DEKLARACIJE -->

<!-- DEKLARACIJA IZVEDBE SKRIPTE -->   
    <!-- id in tip dokumenta --> 

            
<!-- ********************************************************************************************************************************************************************************  -->

<!-- ******************************************************************************************************************************************************************************************** -->      
<!-- INFORMACIJE O PODJETJU IN STRANKI -->
    <image>Printer.Ticket.Logo</image> 
    <line></line>           	
    <line size="2"><text align="right" length="55">${ime}</text></line>
    <line size="2"><text align="right" length="55">${naslov}</text></line>
    <line size="2"><text align="right" length="55">${posta}</text></line>
    <line size="0"><text align="right" length="110">${labelTaxid} ${davcna}</text></line>
    <line size="0"><text align="right" length="110">${maticna}</text></line>
    <line size="0">
        <text align="left" length="55">#if($stranka)${nazivStranke}#end</text>
        <text align="right" length="55">#if($trr.length())${trr}#end</text>
    </line>
    <line size="0">
        <text bold="true" align="left" length="55">#if($stranka.printName())${stranka.printName()}#end</text>
        <text align="right" length="55">#if($telefon.length())${telefon}#end</text>
    </line>
    <line size="0">
        <text bold="true" align="left" length="55">#if($stranka.getAddress())${stranka.getAddress()}#end</text>
        <text align="right" length="55">#if($faks.length())${faks}#end</text>
    </line> 
    <line size="0">
        <text bold="true" align="left" length="55">#if($stranka.getPostal())${stranka.getPostal()}, ${stranka.getCity()}#end</text>
        <text align="right" length="55">#if($email.length())${email}#end</text>
    </line>
    <line size="0">
        <text bold="true" align="left" length="55">#if($stranka.getTaxid())${labelTaxid}${stranka.getTaxid()}#end</text>
        <text align="right" length="55">#if($www.length())${www}#end</text>
    </line>
<!-- KONEC – INFORMACIJE O PODJETJU IN STRANKI -->
<!-- ********************************************************************************************** --> 
<line></line>
<line></line>       
<!-- ******************************************************************************************************************************************************************************************** -->      
<!-- INFORMACIJE O DOKUMENTU – RAČUNU -->
    <!-- ČE JE RAČUN ZAKLUČEN NATISNEMO ID IN PODATKE O RAČUNU drugače pa tip dokumenta iz lastnosti računa --> 
    <line size="1">
        #if(${ticket.ticketType} == 0 && $ticket.getTicketId() > 0)
            <text bold="true" align="left" length="30">Račun št.:</text>
        #elseif(${ticket.ticketType} == 1)
            <text bold="true" align="left" length="30">Storno št.:</text>
        #elseif($lastnosti.getProperty("DOCTYPE") && $lastnosti.getProperty("DOCTYPE") != "Račun")
            <text bold="true" align="left" length="30">$lastnosti.getProperty("DOCTYPE")</text>
        #else
            <text bold="true" align="left" length="30">Informativni predračun</text>
        #end
        <text>${ticket.printId()}</text>
    </line>
    <line><text bold="true" align="left" length="30">${labelTicketdate}</text><text>${ticket.printDate()}</text></line>
    #if ($lastnosti.getProperty("CASHDATE"))
        <line><text bold="true" align="left" length="30">${labelCashdate}</text><text>${lastnosti.getProperty("CASHDATE")}</text></line>
    #end
    
    #if ($lastnosti.getProperty("SERVICEDATE"))
        <line><text bold="true" align="left" length="30">${labelServicedate}</text><text>${lastnosti.getProperty("SERVICEDATE")}</text></line>
    #end
    
    #if ($lastnosti.getProperty("DELIVERYDATE"))
        <line><text bold="true" align="left" length="30">${labelDeliverydate}</text><text>${lastnosti.getProperty("DELIVERYDATE")}</text></line>
    #end
    
    #if ($lastnosti.getProperty("REFERENCE"))
        <line><text bold="true" align="left" length="30">${labelReference}</text><text>${lastnosti.getProperty("REFERENCE")}</text></line>
    #end
    
    <line><text bold="true" align="left" length="30">${labelUsername}</text><text>${ticket.printUser()}</text></line>
<!-- KONEC - INFORMACIJE O DOKUMENTU – RAČUNU -->
<!-- ********************************************************************************************** -->      
<line></line>
<!-- ******************************************************************************************************************************************************************************************** -->      
<!-- POSTAVKE NA RAČUNU -->
    <line>
        <text bold = "true" align="left" length="40">Ime postavke</text>
        <text bold = "true" align="center" length="10">Osnova</text>
        <text bold = "true" align="center" length="10">% DDV</text>
        <text bold = "true" align="center" length="10">Cena z DDV</text>
        <text bold = "true" align="center" length="10">Kol.</text>
        <text bold = "true" align="center" length="15">DDV skupaj</text>
        <text bold = "true" align="right" length="15">Znesek skupaj</text>
    </line>
    <line><text align="left" length="110">––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––</text></line>
    #foreach ($ticketline in $ticket.getLines())
            <line>
            #if ($ticketline.isProductCom())
                <text align ="left" length="40">*${ticketline.printName()}</text>
            #else
                <text align ="left" length="40">${ticketline.printName()}</text>
            #end
                <text align ="right" length="10">${ticketline.printPrice()}</text>
                <text align ="center" length="10">#if($ticketline.getTaxRate() > 0)${ticketline.printTaxRate()}#end</text>
                <text align ="right" length="10">#if($ticketline.getTaxRate() > 0)${ticketline.printPriceTax()}#end</text>
                <text align ="center" length="10">x${ticketline.printMultiply()}</text>
                <text align ="right" length="15">#if($ticketline.getTaxRate() > 0)${ticketline.printTax()}#end</text>                
                <text align ="right" length="15">${ticketline.printValue()}</text>
            </line>
            #if ($ticketline.productAttSetInstId)
                <line><text align ="left" length="110">${ticketline.productAttSetInstDesc}</text></line>
            #end
    #end
    <line><text align="left" length="110">––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––</text></line>
    <line><text>Število enot na računu: </text><text align ="left">${ticket.printArticlesCount()}</text></line>
<!-- KONEC - POSTAVKE NA RAČUNU -->
<!-- ******************************************************************************************************************************************************************************************** -->      
<line></line>
<!-- ******************************************************************************************************************************************************************************************** -->      
<!-- PLAČILA - INFORMACIJE -->
    <line size="2"><text align ="left" length="30">Za plačilo:</text><text align ="right" length="25">${ticket.printTotal()}</text></line>
    #foreach ($paymentline in $ticket.payments)

        #if ($paymentline.name == "cash")
            <line>
                <text align="left" bold="true" length="20">Gotovina:</text>
                <text align ="right" length="90" bold="true">${paymentline.printTotal()}</text>
            </line>

        #end

        #if ($paymentline.name == "cashrefund")
            <line>
                <text align="left" bold="true" length="20">Storno:</text>
                <text align ="right" length="90" bold="true">${paymentline.printTotal()}</text>
            </line>
        #end

        #if ($paymentline.name == "magcard")
            <line size="1"><text align="center" length="42" bold="true">PLAČILNA KARTICA</text></line>
            <line size="1"><text>${paymentline.getCardName()}</text></line>    
            <line><text>${paymentline.printCardNumber()}</text></line>
            <line></line>
            <line size="1"><text align="left" length="10">Skupaj: </text>
                <text align ="right" length="32">${ticket.printTotal()}</text></line>
            <line><text>Trgovec: </text><text>**mojIDtrgovca</text></line>                
            <line><text>ID transakcije:  : </text><text>${paymentline.printTransactionID()}</text></line>
            <line><text>Avtorizacija: </text><text>${paymentline.printAuthorization()}</text></line>
            <line></line>
        #end

        #if ($paymentline.name == "magcardrefund")
                <line><text bold="true">Storno - plačilna kartica:</text></line>
                line size="1"><text>${paymentline.getCardName()}</text></line>    
            <line><text>${paymentline.printCardNumber()}</text></line>
            <line></line>
            <line size="1"><text align="left" length="10">Skupaj: </text>
                <text align ="right" length="32">${ticket.printTotal()}</text></line>
            <line><text>Trgovec: </text><text>**mojIDtrgovca</text></line>                
            <line><text>ID transakcije:  : </text><text>${paymentline.printTransactionID()}</text></line>
            <line><text>Avtorizacija: </text><text>${paymentline.printAuthorization()}</text></line>
            <line></line>
        #end

        #if ($paymentline.name == "cheque")
                <line></line>
                <line><text bold="true">Ček:</text></line>
                <line><text align ="right" length="110">${paymentline.printTotal()}</text></line>
        #end

        #if ($paymentline.name == "chequerefund")
                <line></line>
                <line><text bold="true">Storno - ček:</text></line>
                <line><text align ="right" length="110">${paymentline.printTotal()}</text></line>
        #end

        #if ($paymentline.name == "paperin")
                <line></line>
                <line><text bold="true">Bon:</text></line>
                <line><text align ="right" length="110">${paymentline.printTotal()}</text></line>
        #end

        #if ($paymentline.name == "paperout")
                <line></line>
                <line><text bold="true">Storno - bon:</text></line>
                <line><text align ="right" length="110">${paymentline.printTotal()}</text></line>
        #end

        #if ($paymentline.name == "free")
                <line></line>
                <line><text bold="true">Lastna poraba:</text></line>
                <line><text align ="right" length="110">${paymentline.printTotal()}</text></line>
        #end

        #if ($paymentline.name == "debt")
                <line></line>
                <line><text bold="true">Dolg:</text></line>
                <line><text align ="right" length="110">${paymentline.printTotal()}</text></line>
        #end
        #if ($paymentline.name == "bank")
                <line></line>
                <line size="1"><text bold="true">Nakazilo na TRR:</text></line>
                <line size="1"><text align ="left" length="50">${trr}</text><text align ="right" length="60">${ticket.printTotal()}</text></line>
        #end
    #end
<!-- KONEC - PLAČILA - INFORMACIJE -->
<!-- ******************************************************************************************************************************************************************************************** -->      
<line></line>
<!-- ******************************************************************************************************************************************************************************************** -->      
<!-- POROČILO DDV -->
    #if($lastnosti.getProperty("REVERSETAX") && $stranka)
        <line>
            <text bold="true" align ="left" length="20">Obračun DDV</text>
            <text bold="true" align ="right" length="15">Osnova</text>
            <text bold="true" align ="right" length="15">DDV</text>
        </line>
        <line><text align="left" length="50">––––––––––––––––––––––––––––––––––––––––––––––––––</text></line>
        #if($lastnosti.getProperty("REVERSETAX").contains("22"))
            #set($taxcalc = $ticket.getSubTotal() * 0.22)
            <line>
                <text bold="true" align ="left" length="20">DDV 22%</text>
                <text bold="true" align ="right" length="15">${ticket.printTotal()}</text>
                <text bold="true" align ="right" length="15">${ticket.formatCURRENCY($taxcalc)}</text>
            </line>
        #elseif($lastnosti.getProperty("REVERSETAX").contains("9,5"))
            #set($taxcalc = $ticket.getSubTotal() * 0.095)
            <line>
                <text bold="true" align ="left" length="20">DDV 9,5 %</text>
                <text bold="true" align ="right" length="15">${ticket.printTotal()}</text>
                <text bold="true" align ="right" length="15">${ticket.formatCURRENCY($taxcalc)}</text>
            </line>
        #end
        <line></line>
        <line><text align="center" length="110">Obračun DDV je predmet obrnjene davčne obveznosti po 76.a členu ZDDV-1</text></line>
    #elseif(!$zavezanecDDV) <!-- ČE NISMO ZAVEZANEC NATISNEMO OBVESTILO -->
        <line><text align ="center" length="110">DDV ni obračunan na podlagi 1. odstavka 94. člena ZDDV-1 (nismo zavezanci za DDV)</text></line>
    #elseif($zavezanecDDV =="true")  <!-- ČE SMO ZAVEZANEC IN TO NI RAČUN Z OBRNJENO DAVČNO STOPNJO NATISNEMO POROČILO DDV -->
        <line><text align ="left"  length="20">Osnova za DDV:</text><text align ="right" length="90">${ticket.printSubTotal()}</text></line>
        <line><text align ="left" length="20">DDV:</text><text align ="right" length="90">${ticket.printTax()}</text></line>
        #if(!$ticket.taxes.isEmpty()) <!-- TISKANJE PODROBNOSTI DAVKOV RAČUNA -->
            <line></line>
            <line>
                <text bold="true" align ="left" length="20">Poročilo DDV</text>
                <text bold="true" align ="right" length="15">Osnova</text>
                <text bold="true" align ="right" length="15">DDV</text>
            </line>
            <line><text align="left" length="50">––––––––––––––––––––––––––––––––––––––––––––––––––</text></line>
            #foreach ($taxinfo in $ticket.getTaxLines())
                #if ($taxinfo.getTax() > 0)<!-- TISKANJE DAVKOV OBSTOJEČEGA RAČUNA -->          
                    <line>
                        <text align ="left" length="20">${taxinfo.getName()}</text>
                        <text align ="right" length="15">${taxinfo.printSubTotal()}</text>
                        <text align ="right" length="15">${taxinfo.printTax()}</text>
                    </line>
                #end
            #end
        #end<!-- KONEC - TISKANJE DAVKOV RAČUNA --> 
    #end
   
<!-- KONEC - POROČILO DDV -->
<!-- ******************************************************************************************************************************************************************************************** -->      
<line></line>
<!-- ******************************************************************************************************************************************************************************************** -->      
<!-- OBVESTILA NA DNU RAČUNA V PRIMERU DA JE PLAČILO PREKO BANKE-->
    #foreach ($paymentline in $ticket.payments)
        #if ($paymentline.name == "bank")
        #end
    #end
    <line></line>
    <line><text align="center" length="110">Hvala za obisk</text></line>
    <line><text align="center" length="110">Nasvidenje</text></line>


</ticket>
</output>
<!-- ************* POMOČ ZA NASTAVITEV RAČUNA ************************************************************************************ -->
<!--





-->
